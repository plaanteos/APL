# AUDITOR√çA T√âCNICA DEL SISTEMA APL
## Laboratorio Dental - Gesti√≥n Administrativa

**Fecha de Auditor√≠a:** 20 de enero de 2026  
**Auditor:** Arquitecto de Software Senior / Analista de Sistemas  
**Alcance:** Evaluaci√≥n exhaustiva del sistema desarrollado vs. requerimientos oficiales

---

## üìã RESUMEN EJECUTIVO

El sistema APL presenta una **implementaci√≥n parcial** de los requerimientos especificados. Se identific√≥:

- ‚úÖ **Plataforma Web funcional** con autenticaci√≥n y m√≥dulos principales
- ‚úÖ **Backend robusto** con API RESTful, JWT y validaciones
- ‚úÖ **Base de datos normalizada** con PostgreSQL y Prisma ORM
- ‚ùå **Aplicaci√≥n mobile NO EXISTE** (incumplimiento cr√≠tico de RNF-02)
- ‚ùå **Scripts SQL incompletos** para PostgreSQL (faltan: usuarios/permisos, triggers, consultas de validaci√≥n) - RBD-02
- ‚ö†Ô∏è **Pendientes de arquitectura/DB** (scripts SQL/triggers/√≠ndices/roles seg√∫n motor elegido)
- ‚úÖ **Cola de trabajos** implementada para notificaciones (BullMQ + Redis opcional, con fallback a env√≠o directo)
- ‚úÖ **Cach√©** implementada para cat√°logos (Redis opcional v√≠a `REDIS_URL` + fallback TTL en memoria)
- ‚úÖ **Integraciones de comunicaci√≥n**: env√≠o de Email (Gmail/SMTP) y WhatsApp (Cloud API) implementadas
- ‚úÖ **Recuperaci√≥n de contrase√±a** implementada (forgot/reset)

---

## 1. AN√ÅLISIS DE CUMPLIMIENTO DE REQUERIMIENTOS

### 1.1 REQUERIMIENTOS FUNCIONALES

#### ‚úÖ **RF-01: Login** - **CUMPLIDO**

**Evidencia encontrada:**
- [backend/src/controllers/auth.controller.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/auth.controller.ts#L53-L142): Implementaci√≥n completa de login
- [figma/src/app/components/Login.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Login.tsx): Componente de login en frontend
- Autenticaci√≥n mediante email y contrase√±a
- Generaci√≥n de JWT (access token 15min + refresh token 7 d√≠as)
- Validaci√≥n con Zod
- Rate limiting (5 intentos en 15 minutos)
- Registro en auditor√≠a de intentos fallidos
- ‚úÖ **Funcionalidad "Recordar sesi√≥n" implementada**:
  - Checkbox en formulario de login
  - Uso de localStorage para sesiones persistentes (rememberMe = true)
  - Uso de sessionStorage para sesiones temporales (rememberMe = false)
  - Implementado en [auth.service.ts](file:///c:/Users/Jesu/Desktop/APL/figma/src/services/auth.service.ts)
- ‚úÖ **Recuperaci√≥n de contrase√±a implementada**:
  - Endpoints: `POST /api/auth/forgot-password` y `POST /api/auth/reset-password`
  - Env√≠o de email (Gmail/SMTP) con enlace de recuperaci√≥n

**Observaciones:**
- ‚úÖ Cumple con autenticaci√≥n de usuario administrador
- ‚úÖ Implementa seguridad adicional (bcrypt, JWT, rate limiting)
- ‚úÖ Permite recordar sesi√≥n con persistencia configurable
- ‚úÖ Recuperaci√≥n de contrase√±a: backend implementado y operativo v√≠a email

---

#### ‚úÖ **RF-02: Dashboard Inicial** - **CUMPLIDO**

**Evidencia encontrada:**
- [figma/src/app/components/Dashboard.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Dashboard.tsx): Componente dashboard completo
- Muestra estad√≠sticas:
  - Total de pedidos (l√≠nea 51)
  - Total de clientes (l√≠nea 52)
  - Total de ingresos (l√≠nea 53)
  - Pedidos pendientes (l√≠nea 54)
- Calendario para visualizar pedidos (l√≠nea 153: `<CalendarWidget />`)
- Acci√≥n de logout (l√≠nea 111-117 en App.tsx)
- Barra de navegaci√≥n inferior (l√≠nea 125-178 en App.tsx)

**Observaciones:**
- ‚úÖ Cumple con todos los elementos requeridos
- ‚úÖ Navegaci√≥n funcional hacia otras bandejas
- ‚úÖ Dise√±o responsive y moderno

---

#### ‚úÖ **RF-03: Bandeja de Pedidos** - **CUMPLIDO**

**Evidencia encontrada:**
- [figma/src/app/components/Orders.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Orders.tsx): Componente de pedidos
- [backend/src/controllers/order.controller.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/order.controller.ts): CRUD completo de pedidos
- Endpoints disponibles:
  - `GET /api/orders` - Listar pedidos con filtros
  - `POST /api/orders` - Crear pedido
  - `GET /api/orders/:id` - Obtener pedido espec√≠fico
  - `PUT /api/orders/:id` - Actualizar pedido
  - `DELETE /api/orders/:id` - Eliminar pedido (soft delete)

**Funcionalidades implementadas:**
- ‚úÖ Consultar estado de pedidos
- ‚úÖ Cargar nuevos pedidos
- ‚úÖ Seleccionar pedidos y expandir detalles
- ‚úÖ **Acceso directo al balance del cliente desde pedido**:
  - Bot√≥n "Ver Balance del Cliente" en vista expandida del pedido
  - √çcono TrendingUp para identificaci√≥n visual
  - Navegaci√≥n directa al balance del cliente asociado
  - Implementado con `stopPropagation` para evitar conflictos

**Observaciones:**
- ‚úÖ Cumple completamente con el requerimiento
- ‚úÖ Navegaci√≥n intuitiva y expl√≠cita al balance
- ‚úÖ Mejora la experiencia de usuario con acceso directo

---

#### ‚úÖ **RF-04: Bandeja de Clientes** - **CUMPLIDO**

**Evidencia encontrada:**
- [figma/src/app/components/Clients.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Clients.tsx): Componente de clientes
- [figma/src/app/components/SendMessageDialog.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/SendMessageDialog.tsx): Modal para enviar Email/WhatsApp
- [backend/src/routes/notification.routes.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/routes/notification.routes.ts): Endpoint `POST /api/notifications/send`
- [backend/src/controllers/client.controller.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/client.controller.ts): CRUD completo
- Endpoints disponibles:
  - `GET /api/clients` - Listar clientes con estad√≠sticas
  - `POST /api/clients` - Crear cliente
  - `GET /api/clients/:id` - Obtener cliente
  - `PUT /api/clients/:id` - Actualizar cliente
  - `DELETE /api/clients/:id` - Eliminar cliente
  - `GET /api/clients/:id/balance` - Balance del cliente

**Funcionalidades implementadas:**
- ‚úÖ Consultar informaci√≥n de clientes
- ‚úÖ Cargar nuevos clientes
- ‚úÖ Acceder al balance de cada cliente
- ‚úÖ Enviar mensajes al cliente mediante email o WhatsApp desde un **modal** (SendMessageDialog)

**Observaciones:**
- ‚úÖ Cumple con todos los elementos requeridos
- ‚úÖ Incluye validaciones de email √∫nico
- ‚úÖ Calcula estad√≠sticas din√°micamente (totalPedidos, montoTotal, montoPagado, montoPendiente)

---

#### ‚úÖ **RF-05: Bandeja de Balance** - **CUMPLIDO**

**Evidencia encontrada:**
- [figma/src/app/components/Balance.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Balance.tsx): Componente de balance
- [backend/src/controllers/payment.controller.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/payment.controller.ts): Gesti√≥n de pagos
- [backend/src/controllers/client.controller.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/client.controller.ts#L447-L550): Endpoint [getClientBalance](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/client.controller.ts#447-551)
- [backend/src/routes/order.routes.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/routes/order.routes.ts): Endpoint `PATCH /api/orders/:id/deliver` (marcar entregado)
- [backend/src/routes/client.routes.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/routes/client.routes.ts): Endpoint `GET /api/clients/:id/balance/export` (Excel)
- [backend/src/services/excel.service.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/services/excel.service.ts): Generaci√≥n de Excel con ExcelJS
- [backend/src/routes/notification.routes.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/routes/notification.routes.ts): Endpoint `POST /api/notifications/send` (email/whatsapp)
- [backend/src/services/email.service.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/services/email.service.ts): Env√≠o por SMTP (Gmail recomendado)
- [backend/src/services/whatsapp.service.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/services/whatsapp.service.ts): Env√≠o por WhatsApp Cloud API

**Funcionalidades implementadas:**
- ‚úÖ Gestionar pagos de pedidos (crear, actualizar, eliminar)
- ‚úÖ Visualizar balance total
- ‚úÖ Consultar balances por cliente
- ‚úÖ Agregar pagos
- ‚úÖ Marcar pedidos como entregados
- ‚úÖ Enviar el balance al cliente por WhatsApp o email
- ‚úÖ Descargar el balance del cliente en formato Excel

**Justificaci√≥n t√©cnica:**
El requerimiento RF-05 se considera cumplido al evidenciar:
1. Endpoint para marcar pedido como entregado (`PATCH /api/orders/:id/deliver`)
2. Servicio de email por SMTP (Gmail)
3. Integraci√≥n WhatsApp Cloud API
4. Endpoint para generar Excel (`GET /api/clients/:id/balance/export`)

---

### 1.2 REQUERIMIENTOS DE BASE DE DATOS

#### ‚úÖ **RBD-01: Normalizaci√≥n** - **CUMPLIDO**

**Evidencia encontrada:**
- [backend/prisma/schema.prisma](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/schema.prisma): Esquema completo de base de datos

**An√°lisis de normalizaci√≥n:**

**Primera Forma Normal (1FN):**
- ‚úÖ `Administrador` (id, nombre, telefono, email, usuario, password)
- ‚úÖ `Cliente` (id, nombre, telefono, email, id_administrador)
- ‚úÖ `Pedido` (id, id_cliente, fecha_pedido, fecha_entrega, fecha_delete, id_administrador)

**Segunda Forma Normal (2FN):**
- ‚úÖ `DetallePedido` (id, id_pedido, id_producto, cantidad, precio_unitario, paciente, id_estado)
  - Elimina dependencias parciales, relaciona pedido con producto
- ‚úÖ `Pago` (id, valor, id_administrador)
  - Entidad independiente para pagos
- ‚úÖ `DetallePago` (id, id_pago, id_pedido, valor, fecha_pago)
  - Relaci√≥n N:M entre pago y pedido

**Tercera Forma Normal (3FN):**
- ‚úÖ `Auditoria` (id, usuario, fecha_accion, accion)
  - Tabla independiente sin dependencias transitivas
- ‚úÖ `Estado` (id, descripcion, fecha_insert, fecha_delete)
  - Cat√°logo de estados
- ‚úÖ `Producto` (id, tipo, precio, id_administrador)
  - Cat√°logo de productos

**Observaciones:**
- ‚úÖ Cumple con los tres niveles de normalizaci√≥n especificados
- ‚úÖ Dise√±o coherente con el modelo relacional descrito en [BD/descripcionBD.md](file:///c:/Users/Jesu/Desktop/APL/BD/descripcionBD.md)
- ‚úÖ Uso correcto de claves for√°neas y relaciones

---

#### ‚ö†Ô∏è **RBD-02: Implementaci√≥n T√©cnica** - **PARCIALMENTE CUMPLIDO**

**Evidencia buscada:**
- Scripts SQL para creaci√≥n de base de datos
- Scripts de creaci√≥n de tablas
- Scripts de creaci√≥n de usuarios y permisos
- Scripts de creaci√≥n de √≠ndices
- Scripts de creaci√≥n de triggers
- Scripts de inserci√≥n de datos
- Consultas de validaci√≥n

**Evidencia encontrada:**
- ‚úÖ Esquema Prisma (equivalente a creaci√≥n de tablas): [backend/prisma/schema.prisma](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/schema.prisma)
- ‚úÖ Script de seed (inserci√≥n de datos): [backend/prisma/seed.ts](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/seed.ts)
- ‚úÖ Script SQL (PostgreSQL) para √≠ndices: [backend/prisma/scripts/add_indexes_postgres.sql](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/scripts/add_indexes_postgres.sql)
- ‚ùå **NO se encontraron scripts de creaci√≥n de usuarios y permisos**
- ‚ö†Ô∏è **√çndices**: declarados en Prisma y script SQL; pendiente confirmar ejecuci√≥n/aplicaci√≥n en la BD desplegada
- ‚ùå **NO se encontraron triggers**
- ‚ùå **NO se encontraron consultas de validaci√≥n**

**Justificaci√≥n t√©cnica:**
El requerimiento especifica **expl√≠citamente**:
> "La base de datos debe incluir: Creaci√≥n de la base de datos en **MySQL o PostgreSQL (seg√∫n motor elegido)**, Creaci√≥n de tablas, Creaci√≥n de usuarios y permisos, Creaci√≥n de √≠ndices, Creaci√≥n de triggers, Scripts de inserci√≥n de datos, Consultas para validaci√≥n de datos y pruebas de triggers"

**Hallazgos cr√≠ticos:**
1. **Motor de BD**: El sistema usa **PostgreSQL**, lo cual es v√°lido (motor elegido)
2. **Scripts SQL incompletos**: Se usa Prisma ORM (esquema y migraciones), pero faltan scripts SQL completos para administraci√≥n (roles/permisos), triggers y validaciones
3. **Triggers**: No se encontr√≥ evidencia de triggers para auditor√≠a autom√°tica/validaciones/integridad
4. **√çndices**: Se definieron √≠ndices recomendados (Prisma + script SQL), pero su aplicaci√≥n depende de migraci√≥n/ejecuci√≥n en la BD
5. **Gesti√≥n de usuarios/permisos**: No hay scripts para crear roles/usuarios con permisos m√≠nimos

**Impacto:**
- ‚ö†Ô∏è Incumplimiento parcial del requerimiento RBD-02
- ‚ö†Ô∏è Riesgo de performance si los √≠ndices no est√°n aplicados en la BD desplegada
- ‚ö†Ô∏è Auditor√≠a manual en lugar de autom√°tica (sin triggers)
- ‚ö†Ô∏è Falta de control granular de permisos a nivel de base de datos

**Actualizaci√≥n (PostgreSQL):**
- ‚úÖ Se agreg√≥ script de √≠ndices para PostgreSQL: [backend/prisma/scripts/add_indexes_postgres.sql](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/scripts/add_indexes_postgres.sql)
- ‚úÖ √çndices declarados en Prisma: [backend/prisma/schema.prisma](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/schema.prisma)

---

### 1.3 REQUERIMIENTOS NO FUNCIONALES

#### ‚úÖ **RNF-01: Plataforma Web** - **CUMPLIDO**

**Evidencia encontrada:**
- Frontend web completo en carpeta [figma/](file:///c:/Users/Jesu/Desktop/APL/figma)
- Tecnolog√≠as: React + Vite + TypeScript + TailwindCSS
- Componentes principales:
  - [App.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/App.tsx): Aplicaci√≥n principal
  - [Login.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Login.tsx): Autenticaci√≥n
  - [Dashboard.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Dashboard.tsx): Panel principal
  - [Orders.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Orders.tsx): Gesti√≥n de pedidos
  - [Clients.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Clients.tsx): Gesti√≥n de clientes
  - [Balance.tsx](file:///c:/Users/Jesu/Desktop/APL/figma/src/app/components/Balance.tsx): Balance financiero

**Configuraci√≥n de despliegue:**
- [netlify.toml](file:///c:/Users/Jesu/Desktop/APL/netlify.toml): Configuraci√≥n para Netlify
- URL de producci√≥n: `https://administracionapl.netlify.app` (configurada en CORS del backend)

**Observaciones:**
- ‚úÖ Cumple con el requerimiento de aplicaci√≥n web
- ‚úÖ Accesible desde diferentes direcciones IP (desplegada en Netlify)
- ‚úÖ Dise√±o responsive y moderno
- ‚úÖ Integraci√≥n completa con backend API

---

#### ‚ùå **RNF-02: Plataforma Mobile** - **NO CUMPLIDO**

**Evidencia buscada:**
- Aplicaci√≥n Android (carpeta android, archivos .apk, .gradle)
- Aplicaci√≥n iOS (carpeta ios, archivos .xcodeproj, .swift)
- Framework mobile (React Native, Flutter, Ionic, etc.)

**B√∫squeda realizada:**
- B√∫squeda de carpetas: `*mobile*`, `*android*`, `*ios*` ‚Üí **0 resultados**
- B√∫squeda de archivos de configuraci√≥n mobile ‚Üí **0 resultados**
- Revisi√≥n de estructura del proyecto ‚Üí **Solo web**

**Hallazgos:**
- ‚ùå **NO EXISTE aplicaci√≥n mobile**
- ‚ùå **Incumplimiento total del requerimiento RNF-02**

**Justificaci√≥n t√©cnica:**
El requerimiento especifica:
> "El sistema debe contar con una aplicaci√≥n mobile compatible con Android e iOS"

**Impacto:**
- ‚ùå **Incumplimiento cr√≠tico**: Falta uno de los dos pilares del sistema (web + mobile)
- ‚ùå Los usuarios no pueden gestionar el laboratorio desde dispositivos m√≥viles nativos
- ‚ö†Ô∏è La aplicaci√≥n web es responsive, pero no es equivalente a una app nativa

**Recomendaci√≥n:**
- Desarrollar aplicaci√≥n mobile con React Native o Flutter
- Reutilizar la misma API backend
- Implementar autenticaci√≥n biom√©trica para mobile
- Considerar notificaciones push para pedidos

---

#### ‚ö†Ô∏è **RNF-03: Seguridad** - **PARCIALMENTE CUMPLIDO**

**Evidencia encontrada:**

**Autenticaci√≥n:**
- ‚úÖ Login con credenciales (email + password)
- ‚úÖ Hash de contrase√±as con bcrypt (12 rounds)
- ‚úÖ JWT con access token (15min) y refresh token (7 d√≠as)
- ‚úÖ Middleware de autenticaci√≥n: [backend/src/middleware/auth.middleware.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/middleware/auth.middleware.ts)
- ‚úÖ Rate limiting en login (5 intentos / 15 minutos)

**Cambio de contrase√±a:**
- ‚úÖ Endpoint implementado: `PUT /api/auth/change-password`
- ‚úÖ Validaci√≥n de contrase√±a actual
- ‚úÖ Validaci√≥n de longitud m√≠nima (6 caracteres)
- ‚úÖ Disponible desde web

**Funcionalidades faltantes:**
- ‚ùå **No se evidencia cambio de contrase√±a desde mobile** (porque no existe app mobile)
- ‚úÖ **Recuperaci√≥n de contrase√±a implementada** (forgot/reset password)
- ‚ö†Ô∏è **No se evidencia autenticaci√≥n de dos factores (2FA)**
- ‚ö†Ô∏è **No se evidencia pol√≠tica de expiraci√≥n de contrase√±as**

**Medidas de seguridad adicionales encontradas:**
- ‚úÖ Helmet.js para headers de seguridad
- ‚úÖ CORS configurado con whitelist
- ‚úÖ Validaci√≥n de entrada con Zod
- ‚úÖ Sanitizaci√≥n de respuestas (no se env√≠an passwords)
- ‚úÖ Auditor√≠a de acciones (login, logout, intentos fallidos)

**Observaciones:**
- ‚úÖ Cumple con autenticaci√≥n b√°sica y cambio de contrase√±a
- ‚úÖ Recuperaci√≥n de contrase√±a implementada (cr√≠tico resuelto para producci√≥n)
- ‚ö†Ô∏è Falta 2FA (recomendado para sistemas administrativos)

---

#### ‚ö†Ô∏è **RNF-04: Escalabilidad y Robustez** - **PARCIALMENTE CUMPLIDO**

**Evidencia encontrada:**

**Backend:**
- ‚úÖ Node.js + Express (arquitectura escalable)
- ‚úÖ Prisma ORM con connection pooling
- ‚úÖ Manejo de errores centralizado: [backend/src/middleware/errorHandler.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/middleware/errorHandler.ts)
- ‚úÖ Logging estructurado: [backend/src/utils/logger.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/utils/logger.ts)
- ‚úÖ Validaci√≥n de variables de entorno
- ‚úÖ Graceful shutdown (SIGTERM, SIGINT)
- ‚úÖ Configuraci√≥n para despliegue en Render.com

**Base de datos:**
- ‚úÖ PostgreSQL (base de datos robusta y escalable)
- ‚úÖ Relaciones con integridad referencial
- ‚úÖ √çndices autom√°ticos en claves primarias y √∫nicas
- ‚ö†Ô∏è **√çndices personalizados** definidos (Prisma + script SQL); pendiente confirmar ejecuci√≥n/aplicaci√≥n en la BD
- ‚ö†Ô∏è **Falta triggers** para auditor√≠a autom√°tica
- ‚ö†Ô∏è **Falta particionamiento** para grandes vol√∫menes

**Consultas:**
- ‚úÖ Paginaci√≥n implementada en todos los listados
- ‚úÖ Filtros y b√∫squedas optimizadas
- ‚ö†Ô∏è **C√°lculos din√°micos en cada consulta** (montoPagado, montoPendiente)
  - Impacto: Puede ser lento con muchos pedidos/pagos
  - Recomendaci√≥n: Usar campos calculados o vistas materializadas

**Escalabilidad:**
- ‚úÖ API RESTful stateless (permite escalado horizontal)
- ‚úÖ Separaci√≥n frontend/backend
- ‚úÖ **Cach√©**: cach√© distribuida con **Redis** (v√≠a `REDIS_URL`) + fallback TTL en memoria para cat√°logos (estados/productos)
- ‚úÖ **Cola de trabajos**: cola real para notificaciones (BullMQ + Redis opcional), con reintentos y cleanup
- ‚ö†Ô∏è **No se evidencia CDN** para assets est√°ticos

**Observaciones:**
- ‚úÖ Arquitectura base preparada para escalar
- ‚ö†Ô∏è Pendiente confirmar aplicaci√≥n de √≠ndices en la BD desplegada y completar optimizaciones a nivel BD (triggers, constraints, particionamiento si aplica)
- ‚ö†Ô∏è C√°lculos din√°micos pueden ser cuello de botella

---

## 2. DETECCI√ìN DE FALLAS DEL SISTEMA

### 2.1 FALLAS FUNCIONALES

#### üî¥ **CR√çTICO: Aplicaci√≥n Mobile Inexistente**
- **Descripci√≥n**: No existe aplicaci√≥n mobile para Android e iOS
- **Requerimiento afectado**: RNF-02
- **Impacto**: Incumplimiento total de un requerimiento no funcional cr√≠tico
- **Prioridad**: CR√çTICA

#### ‚úÖ **RESUELTO: Funcionalidades de Balance (RF-05)**
- **Descripci√≥n**: ~~Faltaban funcionalidades clave en RF-05~~ (entregado, env√≠os, Excel)
- **Soluci√≥n implementada**:
  - Endpoint `PATCH /api/orders/:id/deliver`
  - Endpoint `GET /api/clients/:id/balance/export`
  - Endpoint `POST /api/notifications/send` para Email/WhatsApp
- **Estado**: COMPLETADO

#### ‚úÖ **RESUELTO: Acceso a Balance desde Pedidos**
- **Descripci√≥n**: ~~No se evidencia navegaci√≥n directa al balance desde la selecci√≥n de un pedido (RF-03)~~
- **Soluci√≥n implementada**: Bot√≥n "Ver Balance del Cliente" agregado en vista expandida de pedidos
- **Estado**: COMPLETADO

#### ‚úÖ **RESUELTO: Recuperaci√≥n de Contrase√±a**
- **Descripci√≥n**: ~~No exist√≠a funcionalidad de "olvid√© mi contrase√±a"~~
- **Soluci√≥n implementada**: `POST /api/auth/forgot-password` + `POST /api/auth/reset-password` + email de recuperaci√≥n
- **Estado**: COMPLETADO

---

### 2.2 FALLAS DE DISE√ëO (UX/UI)

#### üü¢ **BAJO: Dise√±o General**
- **Observaci√≥n**: El dise√±o web es moderno, responsive y funcional
- **Fortalezas**:
  - Navegaci√≥n clara con barra inferior
  - Uso de iconos intuitivos (Lucide React)
  - Componentes reutilizables (shadcn/ui)
  - Paleta de colores coherente
- **√Åreas de mejora**:
  - No se evidencian estados de carga en todas las acciones
  - No se evidencian mensajes de confirmaci√≥n antes de eliminar
  - No se evidencia manejo de errores visual consistente

---

### 2.3 FALLAS DE ARQUITECTURA

#### ‚úÖ **RESUELTO: Motor de Base de Datos (PostgreSQL)**
- **Descripci√≥n**: El proyecto utiliza PostgreSQL como motor relacional
- **Estado**: ACEPTADO (no es un incumplimiento)
- **Nota**: La evaluaci√≥n se centra en la entrega de scripts SQL del motor elegido (RBD-02)

#### üî¥ **CR√çTICO: Ausencia de Scripts SQL**
- **Descripci√≥n**: No existen scripts SQL completos para PostgreSQL para:
  - Creaci√≥n de base de datos
  - Creaci√≥n de usuarios y permisos
  - Creaci√≥n de √≠ndices personalizados (pendiente aplicar en BD si no se usan migraciones)
  - Creaci√≥n de triggers
  - Consultas de validaci√≥n
- **Impacto**: Incumplimiento parcial de RBD-02
- **Prioridad**: CR√çTICA

#### üü° **MEDIO: C√°lculos Din√°micos Costosos**
- **Descripci√≥n**: Los montos (total, pagado, pendiente) se calculan en cada consulta mediante agregaciones
- **Ubicaci√≥n**: 
  - [client.controller.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/client.controller.ts#L76-L103)
  - [order.controller.ts](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/order.controller.ts)
- **Impacto**: Performance degradada con grandes vol√∫menes de datos
- **Recomendaci√≥n**: Usar campos calculados, triggers o vistas materializadas
- **Prioridad**: MEDIA

#### üü¢ **BAJO: Cach√© Implementada (Redis + TTL)**
- **Descripci√≥n**: Se implement√≥ cach√© para cat√°logos con **fallback a memoria** y opci√≥n de **cach√© distribuida en Redis** (v√≠a `REDIS_URL`).
- **Impacto**: Reduce carga en endpoints de cat√°logo (estados/productos). En despliegues multi-instancia, Redis mantiene consistencia entre instancias.
- **Evidencia**: cach√© en Redis opcional + invalidaci√≥n por prefijo en mutaciones.
- **Prioridad**: BAJA

#### ‚úÖ **RESUELTO: Cola de trabajos para notificaciones**
- **Descripci√≥n**: Se implement√≥ cola de trabajos para env√≠os (email/WhatsApp) con Redis opcional.
- **Soluci√≥n implementada**: BullMQ + worker de notificaciones con reintentos; fallback a env√≠o directo si Redis no est√° configurado.
- **Evidencia**: cola/worker en backend y uso desde el endpoint unificado de notificaciones.
- **Estado**: COMPLETADO

---

### 2.4 PROBLEMAS DE BASE DE DATOS

#### üî¥ **CR√çTICO: Sin Triggers de Auditor√≠a**
- **Descripci√≥n**: La auditor√≠a se realiza manualmente desde el c√≥digo, no autom√°ticamente con triggers
- **Riesgo**: Acciones directas en BD no quedan auditadas
- **Recomendaci√≥n**: Implementar triggers para INSERT, UPDATE, DELETE en tablas cr√≠ticas
- **Prioridad**: ALTA

#### üü° **MEDIO: √çndices Optimizados Pendientes de Aplicar**
- **Descripci√≥n**: Se definieron √≠ndices recomendados, pero deben aplicarse en la BD real (migraci√≥n/ejecuci√≥n)
- **Consultas afectadas**:
  - B√∫squeda de clientes por nombre/email/tel√©fono
  - Filtrado de pedidos por fecha
  - Filtrado de pagos por administrador
- **Recomendaci√≥n**: Crear √≠ndices en:
  ```sql
  CREATE INDEX idx_cliente_nombre ON cliente(nombre);
  CREATE INDEX idx_pedido_fecha ON pedidos(fecha_pedido);
  CREATE INDEX idx_pedido_cliente ON pedidos(id_cliente);
  CREATE INDEX idx_detalle_pago_fecha ON detalle_pago(fecha_pago);
  ```
- **Evidencia**:
  - Script PostgreSQL: [backend/prisma/scripts/add_indexes_postgres.sql](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/scripts/add_indexes_postgres.sql)
  - Prisma schema: [backend/prisma/schema.prisma](file:///c:/Users/Jesu/Desktop/APL/backend/prisma/schema.prisma)
- **Prioridad**: MEDIA

#### üü° **MEDIO: Sin Constraints Adicionales**
- **Descripci√≥n**: Faltan constraints de validaci√≥n a nivel de base de datos:
  - CHECK para valores positivos (precios, cantidades, montos)
  - CHECK para fechas l√≥gicas (fecha_entrega >= fecha_pedido)
- **Impacto**: Validaci√≥n solo en capa de aplicaci√≥n
- **Prioridad**: MEDIA

#### üü° **MEDIO: Sin Gesti√≥n de Usuarios de BD**
- **Descripci√≥n**: No hay scripts para crear usuarios con permisos espec√≠ficos
- **Riesgo**: La aplicaci√≥n usa un usuario con permisos totales
- **Recomendaci√≥n**: Crear usuarios con permisos m√≠nimos necesarios
- **Prioridad**: MEDIA

---

### 2.5 PROBLEMAS DE SEGURIDAD

#### ‚úÖ **RESUELTO: Recuperaci√≥n de Contrase√±a**
- **Descripci√≥n**: Flujo de recuperaci√≥n implementado (forgot/reset)
- **Estado**: COMPLETADO

#### üü° **MEDIO: Sin Autenticaci√≥n de Dos Factores (2FA)**
- **Descripci√≥n**: No se implementa 2FA
- **Impacto**: Menor seguridad en cuentas administrativas
- **Recomendaci√≥n**: Implementar TOTP (Google Authenticator) o SMS
- **Prioridad**: MEDIA

#### üü° **MEDIO: Contrase√±a M√≠nima de 6 Caracteres**
- **Descripci√≥n**: La validaci√≥n permite contrase√±as de solo 6 caracteres
- **Recomendaci√≥n**: Aumentar a 8-12 caracteres y requerir complejidad
- **Prioridad**: MEDIA

#### üü° **MEDIO: Sin Pol√≠tica de Expiraci√≥n de Contrase√±as**
- **Descripci√≥n**: Las contrase√±as no expiran
- **Impacto**: Contrase√±as comprometidas pueden usarse indefinidamente
- **Prioridad**: BAJA

#### üü° **MEDIO: Tokens en Variables de Entorno**
- **Descripci√≥n**: JWT_SECRET en archivo .env
- **Recomendaci√≥n**: Usar gestor de secretos (AWS Secrets Manager, HashiCorp Vault)
- **Prioridad**: MEDIA (para producci√≥n)

---

### 2.6 RIESGOS DE ESCALABILIDAD Y MANTENIBILIDAD

#### üü° **MEDIO: C√°lculos Din√°micos en Algunas Rutas**
- **Descripci√≥n**: Parte de los c√°lculos siguen siendo din√°micos; se optimizaron endpoints cr√≠ticos (clientes/balance) y persisten c√°lculos en otras rutas
- **Ejemplo**: [client.controller.ts:76-113](file:///c:/Users/Jesu/Desktop/APL/backend/src/controllers/client.controller.ts#L76-L113)
- **Impacto**: Con 1000+ clientes y 10,000+ pedidos, las consultas ser√°n lentas
- **Recomendaci√≥n**:
  - Agregar campos calculados: `monto_total`, `monto_pagado`, `monto_pendiente` en tabla `pedidos`
  - Actualizar con triggers o jobs programados
  - Usar vistas materializadas para reportes
- **Prioridad**: MEDIA

#### üü° **MEDIO: Sin Paginaci√≥n en Algunas Consultas**
- **Descripci√≥n**: Algunas consultas no implementan paginaci√≥n
- **Impacto**: Carga completa de datos en memoria
- **Prioridad**: MEDIA

#### üü° **MEDIO: Sin Monitoreo y Observabilidad**
- **Descripci√≥n**: No se evidencia:
  - APM (Application Performance Monitoring)
  - M√©tricas de performance
  - Alertas autom√°ticas
- **Recomendaci√≥n**: Implementar Sentry, DataDog, New Relic o similar
- **Prioridad**: MEDIA

#### üü° **MEDIO: Sin Tests Automatizados**
- **Descripci√≥n**: No se encontraron tests unitarios ni de integraci√≥n
- **Impacto**: Riesgo de regresiones en cambios futuros
- **Recomendaci√≥n**: Implementar Jest + Supertest para backend, Vitest para frontend
- **Prioridad**: MEDIA

#### üü¢ **BAJO: C√≥digo Duplicado**
- **Descripci√≥n**: L√≥gica de c√°lculo de montos repetida en m√∫ltiples controladores
- **Recomendaci√≥n**: Extraer a servicio compartido
- **Prioridad**: BAJA

---

## 3. MATRIZ DE CUMPLIMIENTO

| C√≥digo | Requerimiento | Estado | Cumplimiento | Observaciones |
|--------|---------------|--------|--------------|---------------|
| **RF-01** | Login | ‚úÖ Cumplido | 100% | Implementaci√≥n completa + recordar sesi√≥n |
| **RF-02** | Dashboard Inicial | ‚úÖ Cumplido | 100% | Todos los elementos presentes |
| **RF-03** | Bandeja de Pedidos | ‚úÖ Cumplido | 100% | Incluye bot√≥n de acceso directo a balance |
| **RF-04** | Bandeja de Clientes | ‚úÖ Cumplido | 100% | Funcionalidad completa |
| **RF-05** | Bandeja de Balance | ‚úÖ Cumplido | 100% | Incluye entregado, env√≠os Email/WhatsApp y export Excel |
| **RBD-01** | Normalizaci√≥n | ‚úÖ Cumplido | 100% | 3 niveles de normalizaci√≥n correctos |
| **RBD-02** | Implementaci√≥n T√©cnica | ‚ö†Ô∏è Parcial | 45% | Motor PostgreSQL aceptado; faltan scripts SQL completos (roles/permisos, triggers, validaciones). √çndices definidos pero pendientes de aplicar |
| **RNF-01** | Plataforma Web | ‚úÖ Cumplido | 100% | Web funcional y desplegada |
| **RNF-02** | Plataforma Mobile | ‚ùå No Cumplido | 0% | No existe aplicaci√≥n mobile |
| **RNF-03** | Seguridad | ‚ö†Ô∏è Parcial | 80% | Falta: 2FA y app mobile para gesti√≥n desde mobile |
| **RNF-04** | Escalabilidad y Robustez | ‚ö†Ô∏è Parcial | 80% | Pendiente: confirmar aplicaci√≥n de √≠ndices, completar scripts/triggers/constraints a nivel BD, y CDN opcional |

**Cumplimiento Global: 82%**

---

## 4. RECOMENDACIONES PRIORITARIAS

### üî¥ **PRIORIDAD CR√çTICA**

1. **Desarrollar Aplicaci√≥n Mobile** (RNF-02)
   - Framework recomendado: React Native o Flutter
   - Reutilizar API backend existente
   - Implementar autenticaci√≥n biom√©trica
   - Estimaci√≥n: 4-6 semanas

2. **Crear Scripts SQL Completos** (RBD-02)
  - Scripts SQL para PostgreSQL (motor elegido)
  - Scripts de creaci√≥n de BD y tablas
   - Scripts de usuarios y permisos
   - Scripts de √≠ndices optimizados
   - Scripts de triggers de auditor√≠a
   - Consultas de validaci√≥n
   - Estimaci√≥n: 1-2 semanas

3. **Completar Funcionalidades de Balance** (RF-05)
  - ‚úÖ COMPLETADO (entregado + env√≠os Email/WhatsApp + Excel)

### üü° **PRIORIDAD ALTA**

4. **Implementar Triggers de Auditor√≠a**
   - Triggers para INSERT, UPDATE, DELETE en tablas cr√≠ticas
   - Auditor√≠a autom√°tica sin depender del c√≥digo
   - Estimaci√≥n: 1 semana

5. **Crear √çndices Optimizados**
  - Aplicar/validar √≠ndices definidos (migraciones Prisma o script SQL)
  - Medir performance (EXPLAIN ANALYZE) en queries cr√≠ticas
  - Estimaci√≥n: 1-2 d√≠as

6. **Implementar Recuperaci√≥n de Contrase√±a**
  - ‚úÖ COMPLETADO (forgot/reset + email de recuperaci√≥n)

7. **Optimizar C√°lculos de Balance**
   - Agregar campos calculados en BD
   - Triggers para actualizar montos autom√°ticamente
   - Vistas materializadas para reportes
   - Estimaci√≥n: 1-2 semanas

### üü¢ **PRIORIDAD MEDIA**

8. **Implementar Cach√©**
  - ‚úÖ Cach√© TTL en memoria implementada para cat√°logos (estados/productos)
  - ‚úÖ Cach√© distribuida implementada con Redis (usando `REDIS_URL`)
  - Estimaci√≥n: 0 d√≠as (completado)

9. **Agregar Tests Automatizados**
   - Tests unitarios para servicios
   - Tests de integraci√≥n para API
   - Tests E2E para flujos cr√≠ticos
   - Estimaci√≥n: 2-3 semanas

10. **Implementar 2FA**
    - TOTP con Google Authenticator
    - Backup codes
    - Estimaci√≥n: 1 semana

---

## 5. CONCLUSIONES

### ‚úÖ **Fortalezas del Sistema**

1. **Arquitectura Moderna y Escalable**
   - Backend con Node.js + Express + TypeScript
   - Frontend con React + Vite + TypeScript
   - Base de datos PostgreSQL con Prisma ORM
   - Separaci√≥n clara de responsabilidades

2. **Seguridad B√°sica Implementada**
   - Autenticaci√≥n JWT robusta
   - Hash de contrase√±as con bcrypt
   - Rate limiting en login
   - Validaci√≥n de entrada con Zod
   - CORS configurado correctamente

3. **Base de Datos Bien Dise√±ada**
   - Normalizaci√≥n correcta (1FN, 2FN, 3FN)
   - Relaciones con integridad referencial
   - Modelo coherente con requerimientos

4. **Funcionalidades Core Implementadas**
   - Login funcional
   - Dashboard con estad√≠sticas
   - CRUD completo de clientes, pedidos, pagos
   - C√°lculo din√°mico de balances

### ‚ùå **Debilidades Cr√≠ticas**

1. **Aplicaci√≥n Mobile Inexistente**
   - Incumplimiento total de RNF-02
   - Uno de los dos pilares del sistema no existe

2. **Scripts SQL Incompletos (PostgreSQL)**
  - Incumplimiento parcial de RBD-02
  - Pendiente: roles/usuarios/permisos, triggers y consultas de validaci√≥n

3. **Problemas de Performance**
  - C√°lculos optimizados en endpoints cr√≠ticos (clientes/balance) usando agregaciones SQL
  - √çndices definidos (Prisma + script SQL) para filtros frecuentes (pendiente aplicar migraci√≥n/ejecuci√≥n en DB)
  - Cach√© TTL implementada para cat√°logos (estados/productos)
  - Cola de trabajos implementada para notificaciones (BullMQ + Redis opcional)

5. **Seguridad Mejorable**
  - Recuperaci√≥n de contrase√±a implementada
   - Sin 2FA
   - Contrase√±as d√©biles permitidas (6 caracteres)

### üìä **Evaluaci√≥n Final**

**Cumplimiento Global: 82%**

El sistema APL presenta una **implementaci√≥n mayormente completa** de los requerimientos funcionales. Cuenta con una base s√≥lida en t√©rminos de arquitectura y funcionalidades core. Los principales **incumplimientos cr√≠ticos** son:

- ‚ùå **Aplicaci√≥n mobile inexistente** (RNF-02)
- ‚ö†Ô∏è **Scripts SQL incompletos** (RBD-02)
- ‚ö†Ô∏è **Brecha t√©cnica de BD**: scripts SQL/triggers/usuarios/permisos para PostgreSQL (RBD-02)

**Recomendaci√≥n:** Priorizar (1) desarrollo de la aplicaci√≥n mobile y (2) entregar scripts SQL (PostgreSQL) seg√∫n RBD-02. En paralelo, aplicar los √≠ndices declarados en la BD real y evaluar m√©tricas/latencias con datos representativos.

---

**Fin del Informe de Auditor√≠a T√©cnica**

*Elaborado por: Arquitecto de Software Senior / Analista de Sistemas*  
*Fecha: 20 de enero de 2026*
